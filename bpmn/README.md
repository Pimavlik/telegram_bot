### BPMN 2.0: Поход в гипермаркет и покупка продуктов

Файлы моделей:
- `store-shopping.bpmn` — BPMN 2.0 XML (без DI). Открывается в Camunda Modeler или на `https://demo.bpmn.io`.
- `store-shopping.drawio` — диаграмма для `app.diagrams.net` (draw.io), готова к импорту.

#### Участники (Pools/Lanes)
- **Покупатель**
- **Магазин**
  - **Кассир**
  - **ИС Магазина**
- **Банк‑эквайер**

#### Покрытие требований
- 01.01–01.05: Поведение покупателя, ожидание таблички (таймер), сообщение `Items on belt`.
- 02.01–02.05: Создание ЭД «продажа» с прерывающей ошибкой; подпроцесс «Пробить все товары» с подтверждением транзакционной фиксации от ИС.
- 03.01–03.08: Озвучивание суммы, выбор способа оплаты (шлюз): безнал (обмен с эквайером), наличные (получение/сдача), смешанная оплата (циклический подпроцесс до полной оплаты). Успех ведёт к чекy и сигналу «Свободная касса». Покупатель получает подтверждение/сдачу и завершает процесс.

#### События и прерывания
- Ошибки при создании ЭД у кассира и в ИС — прерывающие boundary error events → `Прерывание (ошибка)`.
- Каждая позиция пробития фиксируется в ИС с подтверждением `Persisted` (сообщение).
- Безналичные платежи: запрос в эквайер и возврат `Approved`/`Declined` (в том числе таймаут как отказ); результат передаётся кассиру. Для смешанной оплаты есть отдельные события внутри подпроцесса.
- Сигнал `Свободная касса` завершает обслуживание.

#### Как открыть
- BPMN: откройте `store-shopping.bpmn` в Camunda Modeler; при необходимости воспользуйтесь Auto Layout или bpmn‑js Token Simulation для проигрывания.
- diagrams.net: `File → Import From → Device…` и выберите `store-shopping.drawio`.

### BPMN 2.0: Поход в гипермаркет и покупка продуктов

Файл модели: `store-shopping.bpmn` (BPMN 2.0 XML, без DI). Открывается в Camunda Modeler/bpmn.io; при отсутствии DI можно использовать авто-лоукат или плагины авто-раскладки.

#### Участники (Pools/Lanes)
- **Покупатель**: от возникновения потребности до выхода из магазина.
- **Магазин**: две дорожки:
  - **Кассир**: обслуживание, пробитие, предложение акций, выдача сдачи, чек.
  - **ИС Магазина**: ЭД «продажа», транзакционная фиксация каждой позиции, запросы в эквайер и ответы кассиру.
- **Банк‑эквайер**: авторизация безналичных платежей.

#### Соответствие требованиям (кратко)
- 01.01–01.05: задачи покупателя и ожидание таблички (таймер‑ивент), затем `msg_ItemsOnBelt` для старта кассира.
- 02.01–02.05: у кассира `Создать ЭД 'продажа'` (+прерывающая ошибка), подпроцесс `Пробить все товары` с подтверждением `Persisted` от ИС. После — предложение акций.
- 03.01–03.08: объявление суммы и **шлюз способов оплаты**: безнал (запрос в ИС → эквайер; ожидание подтверждения/отказа с возвратом к выбору), нал (получение наличных + выдача сдачи), смешанная оплата (циклический подпроцесс до нуля `remainingAmount`). Успех ведет к `Пробить чек` и сигналу `Свободная касса`; покупатель получает подтверждение/сдачу и завершает процесс.

#### Прерывания, ожидания, события
- Ошибки при создании ЭД в кассе и ИС — прерывающие boundary error events → `End_Interrupted`.
- Каждая позиция — асинхронный обмен с ИС, подтверждение транзакционной фиксации.
- Безнал — сообщения Approved/Declined; таймауты представлены через ветку Declined.
- Сигнал `sig_FreeCheckout` — конец обслуживания и готовность кассы.

#### Как открыть
1. Откройте `store-shopping.bpmn` в Camunda Modeler.
2. При необходимости выполните Auto Layout (меню View → Align/Distribute или используйте плагин bpmn-js-token-simulation для проигрывания).

