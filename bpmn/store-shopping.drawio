<mxfile host="app.diagrams.net" modified="2025-09-10T00:00:00.000Z" agent="AI" version="22.0.8" type="device">
  <diagram id="diagramShopping" name="Shopping BPMN">
    <mxGraphModel dx="1440" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1800" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Pool: Customer -->
        <mxCell id="pool_customer" value="Покупатель" style="swimlane;horizontal=1;startSize=28;rounded=0;container=1;recursiveResize=0;" vertex="1" parent="1">
          <mxGeometry x="20" y="40" width="1720" height="220" as="geometry"/>
        </mxCell>

        <!-- Customer tasks -->
        <mxCell id="c_start" value="Продукты закончились" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="40" y="70" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="c_go" value="Отправиться в магазин" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="180" y="70" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="c_basket" value="Взять корзинку и пройти в зал" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="380" y="70" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="c_select" value="Подбор товаров (по списку)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="620" y="70" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="c_queue" value="Ждать очереди в зоне касс" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="860" y="70" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="c_tab" value="Табличка: предыдущий закончил (ожидание)" style="ellipse;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="1100" y="80" width="180" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="c_put" value="Выкладывать товары на ленту" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="1300" y="70" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="c_pay_choice" value="Выбор способа оплаты" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="pool_customer">
          <mxGeometry x="1540" y="80" width="120" height="40" as="geometry"/>
        </mxCell>

        <!-- Pool: Store -->
        <mxCell id="pool_store" value="Магазин" style="swimlane;horizontal=1;startSize=28;rounded=0;container=1;recursiveResize=0;" vertex="1" parent="1">
          <mxGeometry x="20" y="280" width="1720" height="480" as="geometry"/>
        </mxCell>

        <!-- Lane: Cashier -->
        <mxCell id="lane_cashier" value="Кассир" style="swimlane;horizontal=1;startSize=26;rounded=0;container=1;recursiveResize=0;swimlaneFillColor=#ffffff;" vertex="1" parent="pool_store">
          <mxGeometry x="0" y="30" width="1720" height="240" as="geometry"/>
        </mxCell>

        <!-- Lane: Store IS -->
        <mxCell id="lane_is" value="ИС Магазина" style="swimlane;horizontal=1;startSize=26;rounded=0;container=1;recursiveResize=0;swimlaneFillColor=#f8f8f8;" vertex="1" parent="pool_store">
          <mxGeometry x="0" y="270" width="1720" height="180" as="geometry"/>
        </mxCell>

        <!-- Cashier nodes -->
        <mxCell id="k_start" value="Начать обслуживание (получен сигнал)" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="40" y="60" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_create" value="Создать ЭД 'продажа'" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="240" y="60" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_scan" value="Пробить все товары (цикл)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="460" y="60" width="220" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_promos" value="Предложить акции/пакет" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="700" y="60" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_total" value="Озвучить сумму и спросить способ" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="920" y="60" width="260" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_pay_gateway" value="Способ оплаты" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1200" y="70" width="120" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="k_initiate_noncash" value="Инициировать безнал" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1340" y="60" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_cash_recv" value="Получить наличные" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1340" y="130" width="180" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_change" value="Выдать сдачу (если нужно)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1540" y="130" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_approved" value="Оплата подтверждена" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1320" y="40" width="120" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="k_declined" value="Отказ/таймаут" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1320" y="95" width="120" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="k_print" value="Пробить чек" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1540" y="60" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="k_end" value="Свободная касса" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_cashier">
          <mxGeometry x="1710" y="70" width="30" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="k_abort" value="Прерывание (ошибка)" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#cc0000;" vertex="1" parent="lane_cashier">
          <mxGeometry x="220" y="170" width="180" height="40" as="geometry"/>
        </mxCell>

        <!-- Store IS nodes -->
        <mxCell id="is_start" value="Создать ЭД 'продажа' (получено)" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="40" y="40" width="190" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="is_register" value="Зарегистрировать ЭД 'продажа'" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="250" y="40" width="220" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="is_scan_catch" value="Получить пробитый товар" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="490" y="40" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="is_persist" value="Сохранить позицию (транзакционно)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="710" y="40" width="260" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="is_persist_ack" value="Подтверждение сохранения" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="990" y="40" width="160" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="is_send_auth" value="Сформировать запрос безнала и отправить" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="1180" y="40" width="300" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="is_recv_ok" value="Оплата подтверждена" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="1490" y="20" width="160" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="is_recv_fail" value="Отказ/таймаут" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="lane_is">
          <mxGeometry x="1490" y="70" width="160" height="30" as="geometry"/>
        </mxCell>

        <!-- Pool: Acquirer -->
        <mxCell id="pool_acq" value="Банк-эквайер" style="swimlane;horizontal=1;startSize=28;rounded=0;container=1;recursiveResize=0;" vertex="1" parent="1">
          <mxGeometry x="20" y="780" width="1720" height="200" as="geometry"/>
        </mxCell>

        <mxCell id="a_start" value="Получить запрос авторизации" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="pool_acq">
          <mxGeometry x="60" y="60" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a_check" value="Проверка баланса/3DS/антифрод" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_acq">
          <mxGeometry x="280" y="60" width="260" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a_gw" value="Решение" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="pool_acq">
          <mxGeometry x="560" y="70" width="120" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="a_ok" value="Отправить подтверждение" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_acq">
          <mxGeometry x="700" y="40" width="200" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="a_fail" value="Отправить отказ" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="pool_acq">
          <mxGeometry x="700" y="100" width="200" height="40" as="geometry"/>
        </mxCell>

        <!-- Sequence flows (within pools) -->
        <mxCell id="e1" edge="1" parent="1" source="c_start" target="c_go" style="endArrow=block;html=1;"/>
        <mxCell id="e2" edge="1" parent="1" source="c_go" target="c_basket" style="endArrow=block;html=1;"/>
        <mxCell id="e3" edge="1" parent="1" source="c_basket" target="c_select" style="endArrow=block;html=1;"/>
        <mxCell id="e4" edge="1" parent="1" source="c_select" target="c_queue" style="endArrow=block;html=1;"/>
        <mxCell id="e5" edge="1" parent="1" source="c_queue" target="c_tab" style="endArrow=block;html=1;"/>
        <mxCell id="e6" edge="1" parent="1" source="c_tab" target="c_put" style="endArrow=block;html=1;"/>
        <mxCell id="e7" edge="1" parent="1" source="c_put" target="c_pay_choice" style="endArrow=block;html=1;"/>

        <mxCell id="k1" edge="1" parent="1" source="k_start" target="k_create" style="endArrow=block;html=1;"/>
        <mxCell id="k2" edge="1" parent="1" source="k_create" target="k_scan" style="endArrow=block;html=1;"/>
        <mxCell id="k3" edge="1" parent="1" source="k_scan" target="k_promos" style="endArrow=block;html=1;"/>
        <mxCell id="k4" edge="1" parent="1" source="k_promos" target="k_total" style="endArrow=block;html=1;"/>
        <mxCell id="k5" edge="1" parent="1" source="k_total" target="k_pay_gateway" style="endArrow=block;html=1;"/>
        <mxCell id="k6" edge="1" parent="1" source="k_pay_gateway" target="k_initiate_noncash" style="endArrow=block;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;"/>
        <mxCell id="k7" edge="1" parent="1" source="k_pay_gateway" target="k_cash_recv" style="endArrow=block;html=1;entryX=0;entryY=0.5;"/>
        <mxCell id="k8" edge="1" parent="1" source="k_cash_recv" target="k_change" style="endArrow=block;html=1;"/>
        <mxCell id="ks_to_is_auth" edge="1" parent="1" source="k_initiate_noncash" target="is_send_auth" style="endArrow=block;html=1;"/>
        <mxCell id="k12" edge="1" parent="1" source="k_approved" target="k_print" style="endArrow=block;html=1;"/>
        <mxCell id="k13" edge="1" parent="1" source="k_declined" target="k_pay_gateway" style="endArrow=block;html=1;"/>
        <mxCell id="k_err1" edge="1" parent="1" source="k_create" target="k_abort" style="endArrow=block;html=1;strokeColor=#cc0000;dashed=1;"/>
        <mxCell id="is_err1" edge="1" parent="1" source="is_register" target="k_abort" style="endArrow=block;html=1;strokeColor=#cc0000;dashed=1;"/>
        <mxCell id="k10" edge="1" parent="1" source="k_change" target="k_print" style="endArrow=block;html=1;"/>
        <mxCell id="k11" edge="1" parent="1" source="k_print" target="k_end" style="endArrow=block;html=1;"/>

        <mxCell id="is1" edge="1" parent="1" source="is_start" target="is_register" style="endArrow=block;html=1;"/>
        <mxCell id="is2" edge="1" parent="1" source="is_register" target="is_scan_catch" style="endArrow=block;html=1;"/>
        <mxCell id="is3" edge="1" parent="1" source="is_scan_catch" target="is_persist" style="endArrow=block;html=1;"/>
        <mxCell id="is4" edge="1" parent="1" source="is_persist" target="is_persist_ack" style="endArrow=block;html=1;"/>
        <mxCell id="is5" edge="1" parent="1" source="is_persist_ack" target="is_scan_catch" style="endArrow=block;html=1;dashed=1;"/>
        <mxCell id="isa1" edge="1" parent="1" source="is_persist_ack" target="is_send_auth" style="endArrow=block;html=1;"/>

        <mxCell id="a1" edge="1" parent="1" source="a_start" target="a_check" style="endArrow=block;html=1;"/>
        <mxCell id="a2" edge="1" parent="1" source="a_check" target="a_gw" style="endArrow=block;html=1;"/>
        <mxCell id="a3" edge="1" parent="1" source="a_gw" target="a_ok" style="endArrow=block;html=1;"/>
        <mxCell id="a4" edge="1" parent="1" source="a_gw" target="a_fail" style="endArrow=block;html=1;"/>

        <!-- Message flows -->
        <mxCell id="m1" edge="1" parent="1" source="c_put" target="k_start" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m2" edge="1" parent="1" source="k_create" target="is_start" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m3" edge="1" parent="1" source="k_scan" target="is_scan_catch" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m4" edge="1" parent="1" source="is_persist_ack" target="k_scan" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m5" edge="1" parent="1" source="is_send_auth" target="a_start" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m6" edge="1" parent="1" source="a_ok" target="is_recv_ok" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m7" edge="1" parent="1" source="a_fail" target="is_recv_fail" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m8" edge="1" parent="1" source="is_recv_ok" target="k_approved" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m9" edge="1" parent="1" source="is_recv_fail" target="k_declined" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m10" edge="1" parent="1" source="c_pay_choice" target="k_pay_gateway" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m11" edge="1" parent="1" source="c_pay_choice" target="k_cash_recv" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
        <mxCell id="m12" edge="1" parent="1" source="k_change" target="c_pay_choice" style="dashed=1;endArrow=block;endFill=0;html=1;strokeColor=#0000cc;"/>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

