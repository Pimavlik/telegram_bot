<mxGraphModel dx="1440" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" math="0" shadow="0">
  <root>
    <mxCell id="0"/>
    <mxCell id="1" parent="0"/>

    <!-- Pools / Lanes -->
    <mxCell id="poolCustomer" value="Покупатель" style="swimlane;childLayout=stackLayout;horizontalStack=0;startSize=26;horizontal=1;rounded=0;html=1;whiteSpace=wrap;container=1;" parent="1" vertex="1">
      <mxGeometry x="20" y="20" width="1600" height="240" as="geometry"/>
    </mxCell>
    <mxCell id="poolCashier" value="Кассир" style="swimlane;childLayout=stackLayout;horizontalStack=0;startSize=26;horizontal=1;rounded=0;html=1;whiteSpace=wrap;container=1;" parent="1" vertex="1">
      <mxGeometry x="20" y="270" width="1600" height="220" as="geometry"/>
    </mxCell>
    <mxCell id="poolIS" value="ИС магазина" style="swimlane;childLayout=stackLayout;horizontalStack=0;startSize=26;horizontal=1;rounded=0;html=1;whiteSpace=wrap;container=1;" parent="1" vertex="1">
      <mxGeometry x="20" y="500" width="1600" height="220" as="geometry"/>
    </mxCell>
    <mxCell id="poolBank" value="Банк-эквайер" style="swimlane;childLayout=stackLayout;horizontalStack=0;startSize=26;horizontal=1;rounded=0;html=1;whiteSpace=wrap;container=1;" parent="1" vertex="1">
      <mxGeometry x="20" y="730" width="1600" height="180" as="geometry"/>
    </mxCell>

    <!-- Customer lane elements -->
    <mxCell id="c_start" value="01.01 Начало: закончились продукты" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#fff2cc;strokeColor=#d6b656;" parent="poolCustomer" vertex="1">
      <mxGeometry x="30" y="70" width="40" height="40" as="geometry"/>
    </mxCell>
    <mxCell id="c_goStore" value="01.02 Прийти в магазин, взять корзинку, войти в зал" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="poolCustomer" vertex="1">
      <mxGeometry x="90" y="58" width="280" height="64" as="geometry"/>
    </mxCell>
    <mxCell id="c_pick" value="01.03 Подбирать товары по списку" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="poolCustomer" vertex="1">
      <mxGeometry x="390" y="58" width="240" height="64" as="geometry"/>
    </mxCell>
    <mxCell id="c_queue" value="01.04 Идти в кассы и ждать очереди" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="poolCustomer" vertex="1">
      <mxGeometry x="650" y="58" width="260" height="64" as="geometry"/>
    </mxCell>
    <mxCell id="c_putBelt" value="01.05 Выкладывать товары на ленту (после таблички)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="poolCustomer" vertex="1">
      <mxGeometry x="930" y="58" width="320" height="64" as="geometry"/>
    </mxCell>
    <mxCell id="c_cashGive" value="03.05 Передать наличные кассиру (если наличная часть)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="poolCustomer" vertex="1">
      <mxGeometry x="220" y="146" width="340" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="c_cardPay" value="03.04 Произвести безналичную оплату (карта/СБП/иное)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="poolCustomer" vertex="1">
      <mxGeometry x="580" y="146" width="360" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="c_takeGoods" value="03.08 Забрать товары и сдачу, отправиться домой" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="poolCustomer" vertex="1">
      <mxGeometry x="1290" y="146" width="300" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="c_end" value="Конец" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#fff2cc;strokeColor=#d6b656;" parent="poolCustomer" vertex="1">
      <mxGeometry x="1600" y="158" width="40" height="40" as="geometry"/>
    </mxCell>

    <!-- Cashier lane elements -->
    <mxCell id="k_startSvc" value="02.01 Начать обслуживание (клиент на ленте)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="120" y="46" width="320" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="k_createDoc" value="02.02 Создать ЭД 'продажа' (ошибка — прерывание)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="460" y="46" width="360" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="k_scan" value="02.03 Пробивать товары до завершения" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="840" y="46" width="280" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="k_offer" value="02.05 Предложить акции и пакет; при согласии пробить" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="1140" y="46" width="360" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="k_sumAsk" value="03.01 Озвучить сумму и спросить способ оплаты" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="120" y="120" width="420" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="k_subprocPay" value="Подпроцесс: Оплата (комбинированная возможна)" style="shape=callout;perimeter=ellipsePerimeter;rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#000000;dashed=1;" parent="poolCashier" vertex="1">
      <mxGeometry x="560" y="120" width="520" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="k_checkPaid" value="03.07 Покупка полностью оплачена?" style="rhombus;whiteSpace=wrap;html=1;strokeColor=#000000;fillColor=#ffffff;" parent="poolCashier" vertex="1">
      <mxGeometry x="1100" y="126" width="50" height="50" as="geometry"/>
    </mxCell>
    <mxCell id="k_print" value="03.07 Пробить чек; отпустить клиента (Свободная касса)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="1180" y="120" width="380" height="60" as="geometry"/>
    </mxCell>

    <!-- IS lane elements -->
    <mxCell id="is_txn" value="02.04 Транзакционно отражать пробития" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#6c8ebf;" parent="poolIS" vertex="1">
      <mxGeometry x="840" y="46" width="320" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="is_reqCashless" value="03.03 Сформировать запрос безналичной оплаты; связь с эквайером" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#6c8ebf;" parent="poolIS" vertex="1">
      <mxGeometry x="420" y="120" width="500" height="60" as="geometry"/>
    </mxCell>
    <mxCell id="is_saleDone" value="03.07 ЭД 'продажа': выполнен и оплачен" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#6c8ebf;" parent="poolIS" vertex="1">
      <mxGeometry x="1180" y="120" width="360" height="60" as="geometry"/>
    </mxCell>

    <!-- Bank lane elements -->
    <mxCell id="b_verify" value="03.04 Проверка баланса и подтверждение оплаты" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="poolBank" vertex="1">
      <mxGeometry x="460" y="60" width="420" height="60" as="geometry"/>
    </mxCell>

    <!-- Sequence flows: Customer pre-cashier path -->
    <mxCell id="e1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_start" target="c_goStore" edge="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    <mxCell id="e2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_goStore" target="c_pick" edge="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    <mxCell id="e3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_pick" target="c_queue" edge="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>
    <mxCell id="e4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_queue" target="c_putBelt" edge="1">
      <mxGeometry relative="1" as="geometry"/>
    </mxCell>

    <!-- Sequence flows: Cashier scan and offer -->
    <mxCell id="e5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_putBelt" target="k_startSvc" edge="1"/>
    <mxCell id="e6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_startSvc" target="k_createDoc" edge="1"/>
    <mxCell id="e7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_createDoc" target="k_scan" edge="1"/>
    <mxCell id="e8msg" value="синхронно" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=block;endFill=1;strokeColor=#6c8ebf;" parent="1" source="k_scan" target="is_txn" edge="1"/>
    <mxCell id="e9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_scan" target="k_offer" edge="1"/>
    <mxCell id="e10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_offer" target="k_sumAsk" edge="1"/>

    <!-- Payment subprocess framing (visual only) -->
    <mxCell id="e11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_sumAsk" target="k_subprocPay" edge="1"/>

    <!-- Inside payment logic (inclusive and loop) using explicit tasks across lanes -->
    <!-- Exclusive check for cashless choice to trigger bank path (03.02) -->
    <mxCell id="k_cashlessInit" value="03.02 Инициировать безналичный режим" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="560" y="190" width="280" height="50" as="geometry"/>
    </mxCell>
    <mxCell id="is_prepare" value="03.03 Служба ИС: подготовить и отправить запрос оплаты" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#6c8ebf;" parent="poolIS" vertex="1">
      <mxGeometry x="560" y="190" width="420" height="50" as="geometry"/>
    </mxCell>

    <!-- Flows for cashless -->
    <mxCell id="e12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_subprocPay" target="k_cashlessInit" edge="1">
      <mxGeometry relative="1" as="geometry"><mxPoint x="670" y="180" as="targetPoint"/></mxGeometry>
    </mxCell>
    <mxCell id="e13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_cashlessInit" target="is_prepare" edge="1"/>
    <mxCell id="e14msg" value="запрос" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=block;endFill=1;strokeColor=#d6b656;" parent="1" source="is_prepare" target="b_verify" edge="1"/>
    <mxCell id="e15msg" value="подтв." style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=block;endFill=1;strokeColor=#d6b656;" parent="1" source="b_verify" target="is_reqCashless" edge="1"/>
    <mxCell id="e16" value="зачтено" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeColor=#6c8ebf;" parent="1" source="is_reqCashless" target="k_checkPaid" edge="1"/>
    <mxCell id="e16a" value="оплата (покупатель)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=block;endFill=1;strokeColor=#9673a6;" parent="1" source="is_prepare" target="c_cardPay" edge="1"/>

    <!-- Cash branch -->
    <mxCell id="e17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_subprocPay" target="c_cashGive" edge="1"/>
    <mxCell id="k_cashReceive" value="03.06 Получить наличные; выдать сдачу" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="580" y="190" width="330" height="50" as="geometry"/>
    </mxCell>
    <mxCell id="is_cashApply" value="Зачесть наличную оплату (транзакционно)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#6c8ebf;" parent="poolIS" vertex="1">
      <mxGeometry x="930" y="190" width="340" height="50" as="geometry"/>
    </mxCell>
    <mxCell id="e18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_cashGive" target="k_cashReceive" edge="1"/>
    <mxCell id="e19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_cashReceive" target="is_cashApply" edge="1"/>
    <mxCell id="e20" value="зачтено" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeColor=#6c8ebf;" parent="1" source="is_cashApply" target="k_checkPaid" edge="1"/>

    <!-- Gift card branch (03.05) -->
    <mxCell id="k_gift" value="Принять подарочную карту" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="poolCashier" vertex="1">
      <mxGeometry x="560" y="245" width="280" height="50" as="geometry"/>
    </mxCell>
    <mxCell id="is_giftApply" value="Зачесть оплату подарочной картой (транзакционно)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#6c8ebf;" parent="poolIS" vertex="1">
      <mxGeometry x="860" y="245" width="410" height="50" as="geometry"/>
    </mxCell>
    <mxCell id="e21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_subprocPay" target="k_gift" edge="1"/>
    <mxCell id="e22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_gift" target="is_giftApply" edge="1"/>
    <mxCell id="e23" value="зачтено" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeColor=#6c8ebf;" parent="1" source="is_giftApply" target="k_checkPaid" edge="1"/>

    <!-- From paid? to print and to customer -->
    <mxCell id="e24" value="Да" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_checkPaid" target="k_print" edge="1"/>
    <mxCell id="e25msg" value="статус" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=block;endFill=1;strokeColor=#6c8ebf;" parent="1" source="k_print" target="is_saleDone" edge="1"/>
    <mxCell id="e26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_print" target="c_takeGoods" edge="1"/>
    <mxCell id="e27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="c_takeGoods" target="c_end" edge="1"/>

    <!-- From ask sum to paid? (loop when partial payments used) -->
    <mxCell id="e28" value="Нет (еще есть остаток)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;" parent="1" source="k_checkPaid" target="k_subprocPay" edge="1">
      <mxGeometry relative="1" as="geometry"><mxPoint x="1110" y="210" as="targetPoint"/></mxGeometry>
    </mxCell>

  </root>
</mxGraphModel>
